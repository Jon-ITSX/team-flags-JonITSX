services:
  # MongoDB database (OPTIONAL - comment out until credentials available next week)
  # mongodb:
  #   image: mongo:7
  #   container_name: team-flags-mongodb
  #   restart: unless-stopped
  #   ports:
  #     - "27017:27017"
  #   environment:
  #     MONGO_INITDB_ROOT_USERNAME: admin
  #     MONGO_INITDB_ROOT_PASSWORD: password
  #   volumes:
  #     - mongodb_data:/data/db
  #   healthcheck:
  #     test: echo 'db.runCommand("ping").ok' | mongosh localhost:27017/test --quiet
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  # Next.js application
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: team-flags-app
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: production
      # MongoDB is optional - comment out MONGODB_URI until credentials available next week
      # MONGODB_URI: mongodb://admin:password@mongodb:27017/team-flags-edu?authSource=admin
      # MONGODB_DB: team-flags-edu
      STUDENTS_COLLECTION: chas_2026_students
      # Firebase (optional - only if configured)
      # NEXT_PUBLIC_FIREBASE_API_KEY: ${NEXT_PUBLIC_FIREBASE_API_KEY}
      # NEXT_PUBLIC_FIREBASE_PROJECT_ID: ${NEXT_PUBLIC_FIREBASE_PROJECT_ID}
      # FIREBASE_ADMIN_PROJECT_ID: ${FIREBASE_ADMIN_PROJECT_ID}
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  mongodb_data:

networks:
  default:
    name: team-flags-network
